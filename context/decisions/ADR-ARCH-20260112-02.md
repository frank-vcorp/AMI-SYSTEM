# ADR-ARCH-20260112-02: Stack Tecnol√≥gico AMI-SYSTEM

**Estado:** Aceptada

**Fecha:** 2026-01-12

**Autores:** INTEGRA (Arquitecto IA)

**Stakeholders:** FRANK (Director), SOFIA (Constructora), GEMINI (Infraestructura)

**Etiquetas:** `#stack` `#nextjs` `#prisma` `#vercel` `#pwa`

---

## Contexto

- **Problema:** Seleccionar tecnolog√≠as que soporten:
  1. PWA mobile-first con UI responsive
  2. Multi-tenancy desde el inicio
  3. Integraci√≥n con IA (OpenAI) para extracci√≥n de PDFs
  4. Almacenamiento de archivos m√©dicos (PDFs)
  5. Autenticaci√≥n con roles granulares
  6. Bajo costo operativo (servicios managed)

- **Restricciones:**
  - El demo visual ya existe en HTML/Tailwind (mantener consistencia)
  - Equipo familiarizado con React/TypeScript
  - Presupuesto limitado para infraestructura

---

## Decisi√≥n

**Hemos decidido usar el siguiente stack tecnol√≥gico:**

### Frontend

| Tecnolog√≠a | Versi√≥n | Justificaci√≥n |
|------------|---------|---------------|
| **Next.js** | 14+ (App Router) | SSR, API routes, PWA support |
| **React** | 18+ | Componentes, hooks |
| **TypeScript** | 5+ | Tipado est√°tico, mejor DX |
| **Tailwind CSS** | 3+ | Consistente con demo existente |
| **shadcn/ui** | Latest | Componentes accesibles, customizables |
| **React Hook Form** | 7+ | Forms performantes |
| **Zod** | 3+ | Validaci√≥n schema-first |
| **Zustand** | 4+ | State management simple |
| **next-pwa** | Latest | Service worker, offline |

### Backend

| Tecnolog√≠a | Versi√≥n | Justificaci√≥n |
|------------|---------|---------------|
| **Next.js API Routes** | 14+ | Mismo deployment, simplifica infra |
| **Prisma** | 5+ | ORM type-safe, migraciones |
| **PostgreSQL** | 15+ | Relacional, multi-tenant ready |

### Servicios Externos

| Servicio | Proveedor | Uso |
|----------|-----------|-----|
| **Database** | Railway | PostgreSQL managed |
| **Hosting** | Vercel | Frontend + API |
| **Storage** | GCP Cloud Storage | PDFs originales |
| **Auth** | Firebase Auth | Login + Custom Claims |
| **AI** | OpenAI API | Extracci√≥n de PDFs |
| **Email** | Resend o SendGrid | Notificaciones |

### Herramientas de Desarrollo

| Herramienta | Uso |
|-------------|-----|
| **pnpm** | Package manager (monorepo) |
| **Turborepo** | Build system monorepo |
| **ESLint** | Linting |
| **Prettier** | Formatting |
| **Vitest** | Unit testing |
| **Playwright** | E2E testing |

---

## Alternativas Consideradas

### Alternativa 1: Remix en lugar de Next.js

**Pros:**
- ‚úÖ Data loading m√°s elegante
- ‚úÖ Progressive enhancement nativo

**Contras:**
- ‚ùå Menos ecosistema de componentes
- ‚ùå Menos documentaci√≥n PWA
- ‚ùå Equipo no familiarizado

**Raz√≥n del Descarte:** Next.js tiene mejor soporte PWA y m√°s recursos.

### Alternativa 2: Supabase en lugar de Firebase + Railway

**Pros:**
- ‚úÖ Todo en uno (Auth + DB + Storage)
- ‚úÖ Open source

**Contras:**
- ‚ùå Storage tiene l√≠mites m√°s estrictos
- ‚ùå Menos flexible para custom claims complejos

**Raz√≥n del Descarte:** Firebase Auth es m√°s maduro para roles granulares.

### Alternativa 3: tRPC en lugar de REST API

**Pros:**
- ‚úÖ End-to-end type safety
- ‚úÖ Menos boilerplate

**Contras:**
- ‚ùå M√°s dif√≠cil exponer API a terceros
- ‚ùå Curva de aprendizaje

**Raz√≥n del Descarte:** REST es m√°s est√°ndar para integraciones futuras (Portal Empresas, Apps).

---

## Consecuencias

### Positivas
- ‚úÖ Un solo deployment (Vercel) simplifica operaciones
- ‚úÖ Type-safety end-to-end con Prisma + TypeScript
- ‚úÖ PWA funciona desde d√≠a 1
- ‚úÖ Costos predecibles (pay-as-you-go)

### Negativas
- ‚ö†Ô∏è Vendor lock-in parcial con Vercel
- ‚ö†Ô∏è Firebase Auth requiere SDK espec√≠fico

### Mitigaciones
- Prisma abstrae la DB (migrar a otro PostgreSQL es trivial)
- Auth puede abstraerse con un adapter pattern

---

## Configuraci√≥n PWA

```javascript
// next.config.js
const withPWA = require('next-pwa')({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development'
});

module.exports = withPWA({
  // Next.js config
});
```

### Manifest para m√≥vil

```json
{
  "name": "AMI System",
  "short_name": "AMI",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#0066cc",
  "icons": [...]
}
```

---

## Referencias

- [ARCH-20260112-01](ADR-ARCH-20260112-01.md) - Arquitectura Modular
- [ARCH-20260112-03](ADR-ARCH-20260112-03.md) - Modelo de Datos
- Demo legacy: `context/LEGACY_IMPORT/ami-rd/.../Demos funcionales/RD/`

---

**üèóÔ∏è ARCH REFERENCE:** ARCH-20260112-02  
**ü§ñ AUTHOR:** INTEGRA (Arquitecto IA)
